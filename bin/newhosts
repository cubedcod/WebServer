#!/usr/bin/env ruby
STDOUT.sync = true
require_relative '../index'
require 'file-tail'

hosts = {}

File::Tail::Logfile.tail(ENV['HOME'] + '/web.log', :backward => 10) do |line|
#ARGF.each_line do |line|
  line.split(' ').grep(/^http/).map{|u|
    uri = u.R
    host = uri.host
    unless hosts.has_key? host
      hosts[host] = true
      puts ["\e[30;1mhttps://\e[36;7m", host,
            "\e[0m\e[36;1m", uri.path,
            uri.query ? ["\e[0m\e[36m?", uri.query] : nil,
            "\e[0m"].join
    end}
end
