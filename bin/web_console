#!/bin/sh
source /etc/profile
conf=../src/WebServer/config

#uid=$(id -u)
#rules=$(realpath $conf/transparent_proxy)
#su -c "sh $rules $uid"

echo 1024000 | sudo tee /proc/sys/fs/inotify/max_user_watches 

cd ~/web
squid -f $conf/squid.conf

tmux new-session -s HTTP -d
tmux send-keys -t HTTP:0 'sudo socat TCP-LISTEN:80,fork TCP:127.0.0.1:8000 &' C-m
tmux send-keys -t HTTP:0 'sudo socat TCP-LISTEN:443,fork TCP:127.0.0.1:8081 &' C-m
tmux new-window -t HTTP:1 -d httpd
tmux new-window -t HTTP:2 -d syncthing -no-browser
tmux new-window -t HTTP:3 -d logtail

export XDG_RUNTIME_DIR=/run/chrome
export WAYLAND_DISPLAY=w0
export MOZ_ENABLE_WAYLAND=1
export QT_QPA_PLATFORM=wayland
sommelier --data-driver=noop --shm-driver=noop --drm-device=/dev/dri/renderD128 --display=wayland-0 --virtwl-device=/dev/null --master --socket=w0 &
sleep 0.3
termite -e tmux attach-session -t HTTP &
falkon_ &
#midori_ &
